<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive History Exam</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    .question-card { transition: all 0.3s ease; }
    .question-card:hover { transform: translateY(-2px); }
    .option-btn { transition: all 0.2s ease; }
    .option-btn:hover { background-color: #e5e7eb; }
    .correct { background-color: #10b981 !important; color: white; }
    .incorrect { background-color: #ef4444 !important; color: white; }
    .explanation { display: none; margin-top: 10px; padding: 10px; background-color: #f3f4f6; border-radius: 5px; }
    #progressBar { width: 0%; transition: width 0.3s ease; }
    #loading { display: block; }
    #examContent { display: none; }
</style>
<body>
<script>
    // ==========================
    // Configuration: Nested Tabs
    // =========================
    const EXAM_CONFIG = [
        {
            label: 'Ancient History',
            sets: [
                { label: 'Set 1', file: 'questions.txt' }
            ]
    ];
    
    // ==========================
    // State
    // =========================
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let userAnswers = [];
    let answered = false;
    
    let activeCategoryIndex = 0;
    let activeSetIndex = 0;
    
    // ==========================
    // UI Helpers
    // =========================
    function showLoading(show, title = 'Loading Exam Questions...', desc = 'Please wait while we load your questions from the text file.') {
        document.getElementById('loadingTitle').textContent = title;
        document.getElementById('loadingDesc').textContent = desc;
        document.getElementById('loading').style.display = show ? 'block' : 'none';
        if (show) {
            document.getElementById('errorMessage').style.display = 'none';
        }
    }
    
    function setError(msg) {
        const el = document.getElementById('errorMessage');
        el.innerHTML = '<strong>Error:</strong> ' + msg;
        el.style.display = 'block';
        }
    }
    
    function computeScore() {
        if (!questions.length) return 0;
        return userAnswers.reduce((acc, ans, i) => acc + (ans === questions[i]?.correct ? 1 : 0), 0);
    }
    
    // ==========================
    // Tabs Rendering
    // =========================
    function renderTabs() {
        const categoryTabs = document.getElementById('categoryTabs');
        const setTabs = document.getElementById('setTabs');
        
        // Render category tabs
        categoryTabs.innerHTML = '';
        EXAM_CONFIG.forEach((cat, idx) => {
            const btn = document.createElement('button');
            btn.className = 'px-3 py-2 rounded-t text-sm font-medium ' +
                            (idx === activeCategoryIndex ? 'tab-active' : '';
            btn.textContent = cat.label;
            btn.onclick = () => selectCategory(idx);
            categoryTabs.appendChild(btn);
        });
        
        
        // Render set tabs for active category
        setTabs.innerHTML = '';
        const activeCategory = EXAM_CONFIG[activeCategoryIndex];
        activeCategory.sets.forEach((set, idx) => {
            const btn = document.createElement('button');
            btn.className = 'px-3 py-1.5 rounded border text-sm font-medium ' +
                            (idx === activeSetIndex
                                ? 'bg-blue-600 text-white border-blue-600'
                                : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-100';
            btn.textContent = set.label;
            btn.onclick = () => selectSet(idx);
            setTabs.appendChild(btn);
        });
        }
    }
    
    // ==========================
    // Exam Flow
    // =========================
    function initializeExam() {
        currentQuestionIndex = 0;
        score = 0;
        userAnswers = new Array(questions.length).fill(null);
        answered = false;
        
        document.getElementById('questionContainer').style.display = 'block';
        document.getElementById('resultsContainer').style.display = 'none';
        updateDisplay();
        displayQuestion();
    }
    
    function displayQuestion() {
        const q = questions[currentQuestionIndex];
        if (!q) return;
        
        document.getElementById('questionText').textContent = `${currentQuestionIndex + 1}. ${q.text}`;
        
        const optionsContainer = document.getElementById('optionsContainer');
        optionsContainer.innerHTML = '';
        q.options.forEach((opt, idx) => {
            const optionLetter = String.fromCharCode(65 + idx); // A, B, C, D
            const button = document.createElement('button');
            button.className = 'option-btn w-full text-left p-3 border rounded-lg hover:bg-gray-100';
            button.textContent = `${optionLetter}. ${opt}`;
            button.onclick = () => selectAnswer(optionLetter);
            optionsContainer.appendChild(button);
        });
        
        // If already answered, show states and explanation
        if (answered) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, index) => {
                const letter = String.fromCharCode(65 + index);
                if (letter === q.correct) {
                    btn.classList.add('correct');
                } else if (letter === savedAnswer && savedAnswer !== q.correct) {
                    btn.classList.add('incorrect');
                }
                btn.disabled = true;
            }
            
            const explanationContainer = document.getElementById('explanationContainer');
            explanationContainer.innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;
            explanationContainer.style.display = 'block';
            updateDisplay();
            updateButtons();
        }
    }
    
    function selectAnswer(selectedOption) {
        if (answered) return;
        
        const q = questions[currentQuestionIndex];
        userAnswers[currentQuestionIndex] = selectedOption;
        answered = true;
        
        // Show correct/incorrect styling
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach((btn, index) => {
            const optionLetter = String.fromCharCode(65 + index);
            if (optionLetter === q.correct) {
                btn.classList.add('correct');
            } else if (optionLetter === savedAnswer && selectedOption !== q.correct) {
                btn.classList.add('incorrect');
            }
            btn.disabled = true;
            }
        });
        
        // Show explanation
        const explanationContainer = document.getElementById('explanationContainer');
        explanationContainer.innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;
        explanationContainer.style.display = 'block';
        updateDisplay();
        updateButtons();
        }
    }
    
    function nextQuestion() {
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            displayQuestion();
        } else if (answered) {
            showResults();
        }
    }
    
    function previousQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            displayQuestion();
        }
    }
    
    function updateDisplay() {
        const total = questions.length;
        const score = computeScore();
        
        document.getElementById('scoreDisplay').textContent = `Score: ${score}/${total}`;
        document.getElementById('questionCounter').textContent = `Question: ${total ? currentQuestionIndex + 1 : 0}/${total}`;
        
        const progress = total ? ((currentQuestionIndex + 1) / total) * 100 : 0;
        document.getElementById('progressBar').style.width = `${progress}%`;
    }
    
    function updateButtons() {
        const isFirst = currentQuestionIndex === 0;
        const isLast = currentQuestionIndex === questions.length - 1;
        
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        prevBtn.disabled = isFirst;
        nextBtn.textContent = isLast ? 'Show Results' : 'Next';
        nextBtn.disabled = !answered;
    }
    }
    
    function showResults() {
        document.getElementById('questionContainer').style.display = 'none';
        document.getElementById('resultsContainer').style.display = 'block';
        
        const percentage = total ? Math.round((score / total) * 100) : 0;
        document.getElementById('finalScore').textContent = `${score}/${total} (${percentage}%)`;
        
        const detailedResults = document.getElementById('detailedResults');
        detailedResults.innerHTML = '';
        questions.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === question.correct;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `p-3 rounded ${isCorrect ? 'bg-green-100' : 'bg-red-100'`;
            resultDiv.innerHTML = `
                <strong>Q${index + 1}:</strong> ${question.text}<br>
                <strong>Your Answer:</strong> ${userAnswer || 'Not answered'}<br>
                <strong>Correct Answer:</strong> ${question.correct}<br>
                <span class="${isCorrect ? 'text-green-600' : 'text-red-600'}">${isCorrect ? '✓ Correct' : '✗ Incorrect'}</span>`;
            detailedResults.appendChild(resultDiv);
        });
    }
    }
    
    function restartExam() {
        if (questions.length > 0) {
            initializeExam();
        }
    }
    
    // ==========================
    // Init
    // =========================
    window.onload = function () {
        renderTabs();
        loadActiveSet();
    };
</script>
</body>
